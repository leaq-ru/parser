package htmlfinder

import (
	"regexp"
	"strings"
	"sync"
)

type NormalCaseCity = string

// sorted by population
var normalCaseCities = []NormalCaseCity{
	"Москва",
	"Санкт-Петербург",
	"Новосибирск",
	"Екатеринбург",
	"Нижний Новгород",
	"Казань",
	"Самара",
	"Омск",
	"Челябинск",
	"Ростов-на-Дону",
	"Уфа",
	"Волгоград",
	"Пермь",
	"Красноярск",
	"Воронеж",
	"Саратов",
	"Краснодар",
	"Тольятти",
	"Барнаул",
	"Ижевск",
	"Ульяновск",
	"Владивосток",
	"Ярославль",
	"Иркутск",
	"Тюмень",
	"Махачкала",
	"Хабаровск",
	"Оренбург",
	"Новокузнецк",
	"Кемерово",
	"Рязань",
	"Томск",
	"Астрахань",
	"Пенза",
	"Набережные Челны",
	"Липецк",
	"Тула",
	"Киров",
	"Чебоксары",
	"Улан-Удэ",
	"Калининград",
	"Брянск",
	"Курск",
	"Иваново",
	"Магнитогорск",
	"Тверь",
	"Ставрополь",
	"Севастополь",
	"Нижний Тагил",
	"Белгород",
	"Архангельск",
	"Владимир",
	"Сочи",
	"Курган",
	"Симферополь",
	"Смоленск",
	"Калуга",
	"Чита",
	"Саранск",
	"Орёл",
	"Волжский",
	"Череповец",
	"Владикавказ",
	"Мурманск",
	"Сургут",
	"Вологда",
	"Тамбов",
	"Стерлитамак",
	"Грозный",
	"Якутск",
	"Кострома",
	"Комсомольск-на-Амуре",
	"Петрозаводск",
	"Таганрог",
	"Нижневартовск",
	"Йошкар-Ола",
	"Братск",
	"Новороссийск",
	"Дзержинск",
	"Шахты",
	"Нальчик",
	"Орск",
	"Сыктывкар",
	"Нижнекамск",
	"Ангарск",
	"Старый Оскол",
	"Великий Новгород",
	"Балашиха",
	"Благовещенск",
	"Прокопьевск",
	"Химки",
	"Псков",
	"Бийск",
	"Энгельс",
	"Рыбинск",
	"Балаково",
	"Северодвинск",
	"Армавир",
	"Подольск",
	"Королёв",
	"Южно-Сахалинск",
	"Петропавловск-Камчатский",
	"Сызрань",
	"Норильск",
	"Златоуст",
	"Каменск-Уральский",
	"Мытищи",
	"Люберцы",
	"Волгодонск",
	"Новочеркасск",
	"Абакан",
	"Находка",
	"Уссурийск",
	"Березники",
	"Салават",
	"Электросталь",
	"Миасс",
	"Первоуральск",
	"Керчь",
	"Рубцовск",
	"Альметьевск",
	"Ковров",
	"Коломна",
	"Майкоп",
	"Пятигорск",
	"Одинцово",
	"Копейск",
	"Хасавюрт",
	"Новомосковск",
	"Кисловодск",
	"Серпухов",
	"Новочебоксарск",
	"Нефтеюганск",
	"Димитровград",
	"Нефтекамск",
	"Черкесск",
	"Орехово-Зуево",
	"Дербент",
	"Камышин",
	"Невинномысск",
	"Красногорск",
	"Муром",
	"Батайск",
	"Новошахтинск",
	"Сергиев Посад",
	"Ноябрьск",
	"Щёлково",
	"Кызыл",
	"Октябрьский",
	"Ачинск",
	"Северск",
	"Новокуйбышевск",
	"Елец",
	"Арзамас",
	"Евпатория",
	"Обнинск",
	"Новый Уренгой",
	"Каспийск",
	"Элиста",
	"Пушкино",
	"Жуковский",
	"Артём",
	"Междуреченск",
	"Ленинск-Кузнецкий",
	"Сарапул",
	"Ессентуки",
	"Воткинск",
	"Ногинск",
	"Тобольск",
	"Ухта",
	"Серов",
	"Бердск",
	"Великие Луки",
	"Мичуринск",
	"Киселёвск",
	"Новотроицк",
	"Зеленодольск",
	"Соликамск",
	"Раменское",
	"Домодедово",
	"Магадан",
	"Глазов",
	"Каменск-Шахтинский",
	"Железногорск",
	"Канск",
	"Назрань",
	"Гатчина",
	"Саров",
	"Новоуральск",
	"Воскресенск",
	"Долгопрудный",
	"Бугульма",
	"Кузнецк",
	"Губкин",
	"Кинешма",
	"Ейск",
	"Реутов",
	"Усть-Илимск",
	"Железногорск",
	"Усолье-Сибирское",
	"Чайковский",
	"Азов",
	"Бузулук",
	"Озёрск",
	"Балашов",
	"Юрга",
	"Кирово-Чепецк",
	"Кропоткин",
	"Клин",
	"Выборг",
	"Ханты-Мансийск",
	"Троицк",
	"Бор",
	"Шадринск",
	"Белово",
	"Ялта",
	"Минеральные Воды",
	"Анжеро-Судженск",
	"Биробиджан",
	"Лобня",
	"Новоалтайск",
	"Чапаевск",
	"Георгиевск",
	"Черногорск",
	"Минусинск",
	"Михайловск",
	"Елабуга",
	"Дубна",
	"Воркута",
	"Егорьевск",
	"Асбест",
	"Ишим",
	"Феодосия",
	"Белорецк",
	"Белогорск",
	"Кунгур",
	"Лысьва",
	"Гуково",
	"Ступино",
	"Туймазы",
	"Кстово",
	"Вольск",
	"Ишимбай",
	"Зеленогорск",
	"Сосновый Бор",
	"Буйнакск",
	"Борисоглебск",
	"Наро-Фоминск",
	"Будённовск",
	"Донской",
	"Сунжа",
	"Полевской",
	"Лениногорск",
	"Павловский Посад",
	"Славянск-на-Кубани",
	"Заречный",
	"Туапсе",
	"Россошь",
	"Горно-Алтайск",
	"Кумертау",
	"Лабинск",
	"Сибай",
	"Клинцы",
	"Ржев",
	"Тихорецк",
	"Нерюнгри",
	"Алексин",
	"Ревда",
	"Александров",
	"Дмитров",
	"Мелеуз",
	"Сальск",
	"Лесосибирск",
	"Гусь-Хрустальный",
	"Чистополь",
	"Павлово",
	"Чехов",
	"Котлас",
	"Белебей",
	"Искитим",
	"Краснотурьинск",
	"Апатиты",
	"Всеволожск",
	"Прохладный",
	"Михайловка",
	"Анапа",
	"Тихвин",
	"Верхняя Пышма",
	"Ивантеевка",
	"Свободный",
	"Шуя",
	"Когалым",
	"Щёкино",
	"Жигулёвск",
	"Крымск",
	"Вязьма",
	"Видное",
	"Арсеньев",
	"Избербаш",
	"Выкса",
	"Лиски",
	"Волжск",
	"Краснокаменск",
	"Фрязино",
	"Узловая",
	"Лыткарино",
	"Нягань",
	"Рославль",
	"Геленджик",
	"Боровичи",
	"Тимашёвск",
	"Белореченск",
	"Солнечногорск",
	"Назарово",
	"Кириши",
	"Черемхово",
	"Краснокамск",
	"Лесной",
	"Вышний Волочёк",
	"Бугуруслан",
	"Берёзовский",
	"Балахна",
	"Ливны",
	"Донецк",
	"Североморск",
	"Саяногорск",
	"Кимры",
	"Мегион",
	"Кизляр",
	"Урус-Мартан",
	"Снежинск",
	"Кингисепп",
	"Курганинск",
	"Шелехов",
	"Можга",
	"Сертолово",
	"Ярцево",
	"Шали",
	"Отрадный",
	"Торжок",
	"Рузаевка",
	"Волхов",
	"Берёзовский",
	"Куйбышев",
	"Дзержинский",
	"Заринск",
	"Грязи",
	"Чусовой",
	"Надым",
	"Верхняя Салда",
	"Сафоново",
	"Осинники",
	"Кольчугино",
	"Гудермес",
	"Канаш",
	"Рассказово",
	"Сатка",
	"Мончегорск",
	"Усть-Кут",
	"Тулун",
	"Шебекино",
	"Спасск-Дальний",
	"Белая Калитва",
	"Печора",
	"Чебаркуль",
	"Радужный",
	"Усть-Лабинск",
	"Мценск",
	"Мыски",
	"Амурск",
	"Курчатов",
	"Качканар",
	"Салехард",
	"Ефремов",
	"Стрежевой",
	"Аксай",
	"Переславль-Залесский",
	"Ахтубинск",
	"Кашира",
	"Заинск",
	"Камень-на-Оби",
	"Советск",
	"Пугачёв",
	"Лангепас",
	"Бирск",
	"Урюпинск",
	"Моршанск",
	"Пыть-Ях",
	"Конаково",
	"Ртищево",
	"Вязники",
	"Кореновск",
	"Усинск",
	"Тутаев",
	"Красный Сулин",
	"Саянск",
	"Новодвинск",
	"Новозыбков",
	"Людиново",
	"Изобильный",
	"Мариинск",
	"Черняховск",
	"Заволжье",
	"Апшеронск",
	"Красноуфимск",
	"Коряжма",
	"Каменка",
	"Елизово",
	"Фролово",
	"Урай",
	"Большой Камень",
	"Тосно",
	"Алексеевка",
	"Коркино",
	"Кыштым",
	"Лянтор",
	"Моздок",
	"Реж",
	"Партизанск",
	"Джанкой",
	"Шарыпово",
	"Светлоград",
	"Сокол",
	"Ирбит",
	"Гай",
	"Алатырь",
	"Алапаевск",
	"Темрюк",
	"Южноуральск",
	"Учалы",
	"Вичуга",
	"Дальнегорск",
	"Протвино",
	"Мирный",
	"Нижнеудинск",
	"Лесозаводск",
	"Баксан",
	"Беслан",
	"Ялуторовск",
	"Миллерово",
	"Луга",
	"Кизилюрт",
	"Фурманов",
	"Краснознаменск",
	"Зеленокумск",
	"Кулебаки",
	"Добрянка",
	"Кандалакша",
	"Тында",
	"Тайшет",
	"Тавда",
	"Сердобск",
	"Валуйки",
	"Гулькевичи",
	"Вятские Поляны",
	"Истра",
	"Тейково",
	"Абинск",
	"Азнакаево",
	"Новокубанск",
	"Сухой Лог",
	"Углич",
	"Кинель",
	"Благовещенск",
	"Югорск",
	"Слободской",
	"Острогожск",
	"Трёхгорный",
	"Сланцы",
	"Корсаков",
	"Касимов",
	"Шумерля",
	"Муравленко",
	"Чернушка",
	"Сосновоборск",
	"Кушва",
	"Кондопога",
	"Артёмовский",
	"Шатура",
	"Благодарный",
	"Балтийск",
	"Нововоронеж",
	"Нурлат",
	"Зима",
	"Котельники",
	"Приморско-Ахтарск",
	"Старая Русса",
	"Инта",
	"Аша",
	"Богородицк",
	"Киров",
	"Котовск",
	"Ростов",
	"Богданович",
	"Гагарин",
	"Нарткала",
	"Великий Устюг",
	"Маркс",
	"Можайск",
	"Борзя",
	"Ликино-Дулёво",
	"Дюртюли",
	"Петровск",
	"Карабулак",
	"Малгобек",
	"Удомля",
	"Холмск",
	"Кудымкар",
	"Городец",
	"Дагестанские Огни",
	"Усть-Джегута",
	"Верхний Уфалей",
	"Малоярославец",
	"Скопин",
	"Славгород",
	"Мирный",
	"Барабинск",
	"Еманжелинск",
	"Сорочинск",
	"Горячий Ключ",
	"Киржач",
	"Луховицы",
	"Десногорск",
	"Сегежа",
	"Аргун",
	"Дятьково",
	"Кохма",
	"Знаменск",
	"Дедовск",
	"Североуральск",
	"Карталы",
	"Карпинск",
	"Алушта",
	"Карасук",
	"Кировск",
	"Топки",
	"Алейск",
	"Кимовск",
	"Костомукша",
	"Дивногорск",
	"Гусев",
	"Похвистнево",
	"Сасово",
	"Сосногорск",
	"Советская Гавань",
	"Нефтекумск",
	"Морозовск",
	"Полысаево",
	"Дальнереченск",
	"Губаха",
	"Бахчисарай",
	"Медногорск",
	"Октябрьск",
	"Бутурлиновка",
	"Янаул",
	"Лабытнанги",
	"Калач-на-Дону",
	"Камышлов",
	"Зерноград",
	"Уварово",
	"Заречный",
	"Новоалександровск",
	"Майский",
	"Тара",
	"Новопавловск",
	"Советский",
	"Балабаново",
	"Родники",
	"Соль-Илецк",
	"Красноармейск",
	"Красноперекопск",
	"Унеча",
	"Кувандык",
	"Обь",
	"Железногорск-Илимский",
	"Татарск",
	"Ипатово",
	"Семилуки",
	"Исилькуль",
	"Озёры",
	"Буй",
	"Курчалой",
	"Заводоуковск",
	"Кировск",
	"Аткарск",
	"Асино",
	"Киреевск",
	"Богородск",
	"Тайга",
	"Невьянск",
	"Саки",
	"Павловск",
	"Зея",
	"Котельнич",
	"Красноуральск",
	"Ленск",
	"Гурьевск",
	"Зарайск",
	"Бежецк",
	"Железноводск",
	"Семёнов",
	"Красноармейск",
	"Колпашево",
	"Котово",
	"Давлеканово",
	"Калачинск",
	"Строитель",
	"Вельск",
	"Семикаракорск",
	"Отрадное",
	"Карачаевск",
	"Фокино",
	"Северобайкальск",
	"Шарья",
	"Омутнинск",
	"Усть-Катав",
	"Бологое",
	"Волоколамск",
	"Губкинский",
	"Гусиноозёрск",
	"Таштагол",
	"Оленегорск",
	"Оха",
	"Кубинка",
	"Вилючинск",
	"Нелидово",
	"Нерехта",
	"Николаевск-на-Амуре",
	"Верещагино",
	"Нижний Ломов",
	"Лосино-Петровский",
	"Лермонтов",
	"Вихоревка",
	"Никольск",
	"Оса",
	"Зверево",
	"Няндома",
	"Дудинка",
	"Электрогорск",
	"Бавлы",
	"Менделеевск",
	"Армянск",
	"Кировград",
	"Калтан",
	"Лысково",
	"Старая Купавна",
	"Куровское",
	"Ряжск",
	"Остров",
	"Хотьково",
	"Нижняя Тура",
	"Хадыженск",
	"Пикалёво",
	"Тогучин",
	"Льгов",
	"Ершов",
	"Сергач",
	"Светлый",
	"Онега",
	"Шахунья",
	"Ковылкино",
	"Нарьян-Мар",
	"Алдан",
	"Рошаль",
	"Козьмодемьянск",
	"Бронницы",
	"Данков",
	"Лодейное Поле",
	"Боготол",
	"Тырныауз",
	"Лебедянь",
	"Черноголовка",
	"Бакал",
	"Алагир",
	"Абдулино",
	"Сысерть",
	"Суровикино",
	"Райчихинск",
	"Котельниково",
	"Тарко-Сале",
	"Среднеуральск",
	"Буинск",
	"Белоярский",
	"Кизел",
	"Пролетарск",
	"Коммунар",
	"Пущино",
	"Электроугли",
	"Калач",
	"Кяхта",
	"Шимановск",
	"Мурино",
	"Бобров",
	"Карачев",
	"Юрьев-Польский",
	"Новый Оскол",
	"Собинка",
	"Черепаново",
	"Никольское",
	"Новомичуринск",
	"Агрыз",
	"Сортавала",
	"Терек",
	"Нытва",
	"Стародуб",
	"Суворов",
	"Приозерск",
	"Ковдор",
	"Куса",
	"Ардон",
	"Енисейск",
	"Усмань",
	"Нефтегорск",
	"Подпорожье",
	"Петровск-Забайкальский",
	"Инза",
	"Слюдянка",
	"Апрелевка",
	"Рыбное",
	"Талица",
	"Жуковка",
	"Радужный",
	"Харабали",
	"Козельск",
	"Арск",
	"Яровое",
	"Осташков",
	"Туринск",
	"Чегем",
	"Нижняя Салда",
	"Почеп",
	"Сельцо",
	"Константиновск",
	"Новоаннинский",
	"Белоозёрский",
	"Шумиха",
	"Гаврилов-Ям",
	"Ивдель",
	"Покров",
	"Баймак",
	"Кукмор",
	"Поворино",
	"Катав-Ивановск",
	"Мантурово",
	"Голицыно",
	"Бородино",
	"Межгорье",
	"Галич",
	"Пласт",
	"Полярный",
	"Яранск",
	"Кирсанов",
	"Бикин",
	"Барыш",
	"Красновишерск",
	"Абаза",
	"Волгореченск",
	"Куртамыш",
	"Покачи",
	"Щигры",
	"Новоузенск",
	"Касли",
	"Болотное",
	"Жирновск",
	"Ясногорск",
	"Приволжск",
	"Кондрово",
	"Бокситогорск",
	"Советск",
	"Судак",
	"Мензелинск",
	"Поронайск",
	"Калининск",
	"Навашино",
	"Звенигород",
	"Агидель",
	"Белогорск",
	"Невель",
	"Сухиничи",
	"Камызяк",
	"Плавск",
	"Кашин",
	"Чудово",
	"Иланский",
	"Валдай",
	"Ясный",
	"Ужур",
	"Новоульяновск",
	"Краснослободск",
	"Палласовка",
	"Светогорск",
	"Пестово",
	"Данилов",
	"Заполярный",
	"Лакинск",
	"Рыльск",
	"Медвежьегорск",
	"Грязовец",
	"Ленинск",
	"Дегтярск",
	"Купино",
	"Бодайбо",
	"Венёв",
	"Жердевка",
	"Меленки",
	"Петушки",
	"Полярные Зори",
	"Николаевск",
	"Белокуриха",
	"Цимлянск",
	"Александровск",
	"Трубчевск",
	"Очёр",
	"Нерчинск",
	"Лукоянов",
	"Карабаново",
	"Кодинск",
	"Емва",
	"Первомайск",
	"Вяземский",
	"Сим",
	"Мамадыш",
	"Красный Кут",
	"Струнино",
	"Дубовка",
	"Лагань",
	"Арамиль",
	"Южа",
	"Пересвет",
	"Катайск",
	"Гороховец",
	"Шилка",
	"Белёв",
	"Далматово",
	"Гвардейск",
	"Фокино",
	"Калязин",
	"Талдом",
	"Сясьстрой",
	"Свирск",
	"Байкальск",
	"Обоянь",
	"Кудрово",
	"Руза",
	"Цивильск",
	"Ак-Довурак",
	"Краснозаводск",
	"Шлиссельбург",
	"Петров Вал",
	"Яхрома",
	"Могоча",
	"Хвалынск",
	"Карабаш",
	"Камешково",
	"Кемь",
	"Анадырь",
	"Горняк",
	"Торопец",
	"Зеленоградск",
	"Аркадак",
	"Снежногорск",
	"Адыгейск",
	"Уяр",
	"Кораблино",
	"Чаплыгин",
	"Киренск",
	"Удачный",
	"Юрюзань",
	"Балей",
	"Окуловка",
	"Малая Вишера",
	"Нязепетровск",
	"Гурьевск",
	"Новая Ляля",
	"Сосенский",
	"Чкаловск",
	"Вуктыл",
	"Горнозаводск",
	"Урень",
	"Печоры",
	"Боровск",
	"Лихославль",
	"Долинск",
	"Волосово",
	"Жуков",
	"Сорск",
	"Называевск",
	"Бабаево",
	"Тюкалинск",
	"Заволжск",
	"Чулым",
	"Сосновка",
	"Звенигово",
	"Углегорск",
	"Судогда",
	"Верхний Тагил",
	"Дрезна",
	"Богучар",
	"Неман",
	"Михайлов",
	"Невельск",
	"Сураж",
	"Ворсма",
	"Кремёнки",
	"Опочка",
	"Тетюши",
	"Хилок",
	"Питкяранта",
	"Завитинск",
	"Болхов",
	"Эртиль",
	"Нариманов",
	"Петухово",
	"Луза",
	"Закаменск",
	"Белая Холуница",
	"Беломорск",
	"Нижние Серги",
	"Заозёрск",
	"Зуевка",
	"Гаджиево",
	"Камбарка",
	"Пионерский",
	"Гремячинск",
	"Щучье",
	"Шагонар",
	"Дигора",
	"Светлогорск",
	"Микунь",
	"Дорогобуж",
	"Заозёрный",
	"Высоковск",
	"Каргат",
	"Щёлкино",
	"Александровск-Сахалинский",
	"Порхов",
	"Змеиногорск",
	"Суздаль",
	"Вытегра",
	"Кола",
	"Кирс",
	"Ермолино",
	"Козловка",
	"Сольцы",
	"Вилюйск",
	"Уржум",
	"Наволоки",
	"Юрьевец",
	"Миньяр",
	"Мариинский Посад",
	"Нюрба",
	"Краснослободск",
	"Каргополь",
	"Ельня",
	"Харовск",
	"Южно-Сухокумск",
	"Рудня",
	"Волчанск",
	"Кувшиново",
	"Володарск",
	"Нея",
	"Ивангород",
	"Тотьма",
	"Суоярви",
	"Пудож",
	"Задонск",
	"Таруса",
	"Болохово",
	"Белозерск",
	"Ядрин",
	"Городовиковск",
	"Сковородино",
	"Нолинск",
	"Покровск",
	"Олёкминск",
	"Устюжна",
	"Верхняя Тура",
	"Верхнеуральск",
	"Ардатов",
	"Облучье",
	"Западная Двина",
	"Серафимович",
	"Старый Крым",
	"Михайловск",
	"Перевоз",
	"Костерёво",
	"Теберда",
	"Дно",
	"Олонец",
	"Чадан",
	"Бирюсинск",
	"Ветлуга",
	"Новая Ладога",
	"Верхотурье",
	"Починок",
	"Липки",
	"Комсомольск",
	"Инсар",
	"Болгар",
	"Старица",
	"Пучеж",
	"Белинский",
	"Никольск",
	"Анива",
	"Белоусово",
	"Макушино",
	"Медынь",
	"Андреаполь",
	"Малмыж",
	"Салаир",
	"Новосокольники",
	"Сычёвка",
	"Городище",
	"Томмот",
	"Мглин",
	"Бирюч",
	"Лахденпохья",
	"Алупка",
	"Мамоново",
	"Спасск-Рязанский",
	"Кириллов",
	"Лаишево",
	"Дмитриев",
	"Велиж",
	"Оханск",
	"Полесск",
	"Советск",
	"Спасск",
	"Демидов",
	"Весьегонск",
	"Севск",
	"Темников",
	"Макарьев",
	"Юхнов",
	"Сурск",
	"Красавино",
	"Орлов",
	"Сенгилей",
	"Зубцов",
	"Сретенск",
	"Новохопёрск",
	"Курлово",
	"Макаров",
	"Каменногорск",
	"Мураши",
	"Алзамай",
	"Княгинино",
	"Шацк",
	"Солигалич",
	"Гаврилов Посад",
	"Багратионовск",
	"Себеж",
	"Грайворон",
	"Циолковский",
	"Игарка",
	"Приморск",
	"Пошехонье",
	"Шиханы",
	"Суджа",
	"Дмитровск",
	"Мышкин",
	"Спас-Клепики",
	"Короча",
	"Сусуман",
	"Пыталово",
	"Шенкурск",
	"Усолье",
	"Красный Холм",
	"Жиздра",
	"Любим",
	"Злынка",
	"Билибино",
	"Фатеж",
	"Верея",
	"Чухлома",
	"Туран",
	"Чердынь",
	"Спас-Деменск",
	"Кадников",
	"Озёрск",
	"Пустошка",
	"Славск",
	"Нестеров",
	"Бабушкин",
	"Томари",
	"Гдов",
	"Духовщина",
	"Правдинск",
	"Мосальск",
	"Любань",
	"Певек",
	"Мещовск",
	"Чёрмоз",
	"Малоархангельск",
	"Холм",
	"Новосиль",
	"Ладушкин",
	"Белый",
	"Новоржев",
	"Мезень",
	"Среднеколымск",
	"Краснознаменск",
	"Кологрив",
	"Магас",
	"Сольвычегодск",
	"Кедровый",
	"Северо-Курильск",
	"Плёс",
	"Горбатов",
	"Артёмовск",
	"Островной",
	"Курильск",
	"Приморск",
	"Верхоянск",
	"Высоцк",
	"Чекалин",
	"Иннополис",
}

var list = make(map[NormalCaseCity][]string, len(normalCaseCities))

var rxRuLow = regexp.MustCompile(`[абвгдеёжзийклмнопрстуфхцчшщъыьэюя]+`)

func init() {
	// prepare list
	for _, c := range normalCaseCities {
		name := strings.ToLower(c)

		citySpace := strings.Join([]string{
			"г",
			name,
		}, " ")

		typos := []string{citySpace}

		if strings.Contains(name, "-") {
			noDashCitySpace := strings.ReplaceAll(citySpace, "-", " ")

			typos = append(typos, noDashCitySpace)
		}

		list[c] = typos
	}
}

func FindCity(text string) (found NormalCaseCity, isFound bool) {
	ruLowChars := rxRuLow.FindAllString(strings.ToLower(text), -1)
	if ruLowChars == nil || len(ruLowChars) == 0 {
		return
	}

	lowText := strings.Join(ruLowChars, " ")

	wg := sync.WaitGroup{}
	mu := sync.Mutex{}
	for nc, typos := range list {
		for _, t := range typos {
			wg.Add(1)
			go func(nCase NormalCaseCity, typo string) {
				defer wg.Done()

				mu.Lock()
				alreadyFound := found != ""
				mu.Unlock()
				if alreadyFound {
					return
				}

				if strings.Contains(lowText, typo) {
					mu.Lock()
					found = nCase
					mu.Unlock()
				}
			}(nc, t)
		}
	}
	wg.Wait()

	isFound = found != ""
	return
}
